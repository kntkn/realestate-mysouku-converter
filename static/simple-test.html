<!DOCTYPE html>
<html>
<head>
    <title>簡単テスト</title>
    <style>
        body { font-family: Arial; padding: 20px; max-width: 800px; margin: 0 auto; }
        .test-section { border: 1px solid #ddd; margin: 10px 0; padding: 15px; border-radius: 5px; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; font-family: monospace; white-space: pre-wrap; }
        .success { background: #e8f5e9; border: 1px solid #4caf50; }
        .error { background: #ffebee; border: 1px solid #f44336; }
        .waiting { background: #fff3e0; border: 1px solid #ff9800; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>PDF処理テスト（簡単版）</h1>
    
    <!-- Step 1: PDFファイル選択 -->
    <div class="test-section">
        <h3>Step 1: PDFファイルを選択</h3>
        <input type="file" id="pdfFile" accept=".pdf">
        <div id="fileStatus" class="result">PDFファイルを選択してください</div>
    </div>
    
    <!-- Step 2: PyPDF2テスト -->
    <div class="test-section">
        <h3>Step 2: PyPDF2テスト（既存ライブラリ）</h3>
        <button onclick="testPyPDF2()" disabled id="testPyPDF2Btn">PyPDF2テスト実行</button>
        <div id="pypdf2Result" class="result">まずPDFファイルを選択してください</div>
    </div>
    
    <!-- Step 3: pdfplumber高精度検出テスト -->
    <div class="test-section">
        <h3>Step 3: pdfplumber高精度検出テスト</h3>
        <button onclick="testPdfPlumber()" disabled id="testPdfPlumberBtn">pdfplumber検出テスト実行</button>
        <div id="pdfplumberResult" class="result">まずPDFファイルを選択してください</div>
    </div>
    
    <script>
    document.getElementById('pdfFile').addEventListener('change', function() {
        const file = this.files[0];
        const fileStatus = document.getElementById('fileStatus');
        
        if (file) {
            fileStatus.textContent = `✅ ファイル選択: ${file.name} (${Math.round(file.size/1024)}KB)`;
            fileStatus.className = 'result success';
            
            // テストボタンを有効化
            document.getElementById('testPyPDF2Btn').disabled = false;
            document.getElementById('testPdfPlumberBtn').disabled = false;
        } else {
            fileStatus.textContent = 'PDFファイルを選択してください';
            fileStatus.className = 'result';
            
            // テストボタンを無効化
            document.getElementById('testPyPDF2Btn').disabled = true;
            document.getElementById('testPdfPlumberBtn').disabled = true;
        }
    });
    
    async function testPyPDF2() {
        const resultDiv = document.getElementById('pypdf2Result');
        const file = document.getElementById('pdfFile').files[0];
        
        resultDiv.textContent = '⏳ PyPDF2テスト実行中...';
        resultDiv.className = 'result waiting';
        
        const formData = new FormData();
        formData.append('pdf_file', file);
        
        try {
            const response = await fetch('/test_pypdf2_only', {
                method: 'POST',
                body: formData
            });
            
            const result = await response.json();
            
            if (result.status === 'success') {
                resultDiv.textContent = `✅ PyPDF2成功!\nページ数: ${result.page_count}\nテキスト長: ${result.text_length}文字`;
                resultDiv.className = 'result success';
            } else {
                resultDiv.textContent = `❌ PyPDF2エラー:\n${result.message}`;
                resultDiv.className = 'result error';
            }
            
        } catch (error) {
            resultDiv.textContent = `❌ 通信エラー:\n${error.message}`;
            resultDiv.className = 'result error';
        }
    }
    
    async function testPdfPlumber() {
        const resultDiv = document.getElementById('pdfplumberResult');
        const file = document.getElementById('pdfFile').files[0];
        
        resultDiv.textContent = '⏳ pdfplumber検出テスト実行中...';
        resultDiv.className = 'result waiting';
        
        const formData = new FormData();
        formData.append('pdf_file', file);
        
        try {
            const response = await fetch('/test_pdfplumber_detection', {
                method: 'POST',
                body: formData
            });
            
            const result = await response.json();
            
            if (result.status === 'success') {
                const detection = result.detection_result;
                resultDiv.textContent = `✅ pdfplumber検出成功!\nフッター高さ: ${detection.bottom_height}mm\n信頼度: ${detection.confidence}%\n検出方法: ${detection.method}\nキーワード数: ${detection.keywords_found}`;
                resultDiv.className = 'result success';
            } else {
                resultDiv.textContent = `❌ pdfplumber検出エラー:\n${result.message}`;
                resultDiv.className = 'result error';
            }
            
        } catch (error) {
            resultDiv.textContent = `❌ 通信エラー:\n${error.message}`;
            resultDiv.className = 'result error';
        }
    }
    </script>
</body>
</html>